(function(){var thisForm=false,formID=0,event=false,frmstripe,running=100,elements,isStripeLink=false,linkAuthenticationElementIsComplete=false,stripeLinkElementIsComplete=false;function validateForm(e){var action,ccField;thisForm=this;formID=jQuery(thisForm).find('input[name="form_id"]').val();if(formID==frm_stripe_vars.form_id){action=jQuery(thisForm).find('input[name="frm_action"]').val();if("create"===action){ccField=jQuery(thisForm).find(".frm-card-element");if(ccField.length&&!ccField.is(":hidden")){e.preventDefault();
event=e;processForm();return}}}frmFrontForm.submitFormManual(e,thisForm);return false}function processForm(){var $form,meta;$form=jQuery(thisForm);$form.addClass("frm_js_validate");if(!validateFormSubmit($form))return;frmFrontForm.showSubmitLoading($form);meta=addNameAndAddress($form);if(!isStripeLink)return;stripeLinkSubmit($form.get(0),meta)}function stripeLinkSubmit(object,meta){object.classList.add("frm_trigger_event_on_submit","frm_ajax_submit");object.addEventListener("frmSubmitEvent",confirmPayment);
running=0;submitForm();function confirmPayment(){var params,confirmFunction;window.onpageshow=function(event){if(event.persisted||window.performance&&window.performance.getEntriesByType("navigation")[0].type==="back_forward")window.location.reload()};params={elements:elements,confirmParams:{return_url:frm_stripe_vars.ajax+"?action=frmstrplinkreturn",payment_method_data:{billing_details:convertToAddressObject(meta)}}};confirmFunction=isRecurring()?"confirmSetup":"confirmPayment";frmstripe[confirmFunction](params).then(handleConfirmPromise)}
function handleConfirmPromise(result){if(result.error)handleConfirmPaymentError(result.error)}function handleConfirmPaymentError(error){var fieldset,cardErrors;running--;enableSubmit();fieldset=jQuery(object).find(".frm_form_field");fieldset.removeClass("frm_doing_ajax");object.classList.remove("frm_loading_form");if("card_error"===error.type){cardErrors=object.querySelector(".frm-card-errors");if(cardErrors)cardErrors.textContent=error.message}}}function isRecurring(){var isRecurring=false;each(getStripeSettings(),
function(setting){if("recurring"===setting.one){isRecurring=true;return false}});return isRecurring}function validateFormSubmit($form){var errors,keys;errors=frmFrontForm.validateFormSubmit($form);keys=Object.keys(errors);if(1===keys.length&&errors[keys[0]]==="")keys.pop();return 0===keys.length}function addNameAndAddress($form){var addressContainer,prefix,i,firstField,lastField,firstFieldContainer,lastFieldContainer,cardObject={},settings=frm_stripe_vars.settings,addressID="",firstNameID="",lastNameID=
"",getNameFieldValue;getNameFieldValue=function(field,subFieldName){if("object"!==typeof field)field=document.getElementById("frm_field_"+field+"_container");if(!field||"object"!==typeof field||"function"!==typeof field.querySelector)return"";var subFieldEl=field.querySelector(".frm_combo_inputs_container .frm_form_subfield-"+subFieldName+" input");if(!subFieldEl)return"";return subFieldEl.value};for(i=0;i<settings.length;i++){addressID=settings[i].address;firstNameID=settings[i].first_name;lastNameID=
settings[i].last_name}if(addressID!==""){addressContainer=$form.find("#frm_field_"+addressID+"_container");prefix="";if(addressContainer.length<1){addressContainer=$form.find('input[name="item_meta['+addressID+'][line1]"]');if(addressContainer.length){prefix=addressID+"][";addressContainer=addressContainer.parent()}}if(addressContainer.length){cardObject=addValToRequest(addressContainer,prefix+"line1",cardObject,"address_line1");cardObject=addValToRequest(addressContainer,prefix+"line2",cardObject,
"address_line2");cardObject=addValToRequest(addressContainer,prefix+"city",cardObject,"address_city");cardObject=addValToRequest(addressContainer,prefix+"state",cardObject,"address_state");cardObject=addValToRequest(addressContainer,prefix+"zip",cardObject,"address_zip")}}if(firstNameID!==""){firstFieldContainer=document.getElementById("frm_field_"+firstNameID+"_container");if(firstFieldContainer&&firstFieldContainer.querySelector(".frm_combo_inputs_container"))cardObject.name=getNameFieldValue(firstFieldContainer,
"first");else{firstField=$form.find("#frm_field_"+firstNameID+'_container input, input[name="item_meta['+firstNameID+']"]');if(firstField.length&&firstField.val())cardObject.name=firstField.val()}}if(lastNameID!==""){lastFieldContainer=document.getElementById("frm_field_"+lastNameID+"_container");if(lastFieldContainer&&lastFieldContainer.querySelector(".frm_combo_inputs_container"))cardObject.name=cardObject.name+" "+getNameFieldValue(lastFieldContainer,"last");else{lastField=$form.find("#frm_field_"+
lastNameID+'_container input, input[name="item_meta['+lastNameID+']"]');if(lastField.length&&lastField.val())cardObject.name=cardObject.name+" "+lastField.val()}}return cardObject}function addValToRequest(container,inputName,cardObject,objectName){var input=container.find('input[name$="['+inputName+']"]');if(input.length&&input.val())cardObject[objectName]=input.val();return cardObject}function convertToAddressObject(meta){var newMeta,k;newMeta={address:{}};for(k in meta)if(meta.hasOwnProperty(k))if(k===
"address_zip")newMeta.address.postal_code=meta[k];else if(k.indexOf("address_")===0)newMeta.address[k.replace("address_","")]=meta[k];else newMeta[k]=meta[k];return newMeta}function submitForm(){if(running>0)return;frmFrontForm.submitFormManual(event,thisForm)}function enableSubmit(){if(running>0)return;thisForm.classList.add("frm_loading_form");frmFrontForm.removeSubmitLoading(jQuery(thisForm),"enable",0);triggerCustomEvent(thisForm,"frmStripeLiteEnableSubmit")}function triggerCustomEvent(el,eventName,
data){var event;if(typeof window.CustomEvent==="function")event=new CustomEvent(eventName);else if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent(eventName,false,true)}else return;event.frmData=data;el.dispatchEvent(event)}function getPriceFields(){var priceFields=[];function checkStripeSettingForPriceFields(setting){if(-1!==setting.fields)each(setting.fields,addFieldDataToPriceFieldsArray)}function addFieldDataToPriceFieldsArray(field){if(isNaN(field))priceFields.push("field_"+
field);else priceFields.push(field)}each(getStripeSettings(),checkStripeSettingForPriceFields);return priceFields}function getStripeSettings(){var stripeSettings=[];each(frm_stripe_vars.settings,function(setting){if(-1!==setting.gateways.indexOf("stripe"))stripeSettings.push(setting)});return stripeSettings}function priceChanged(_,field,fieldId){var i,data,price=getPriceFields(),run=price.indexOf(fieldId)>-1||price.indexOf(field.id)>-1;if(!run)for(i=0;i<price.length;i++)if(field.id.indexOf(price[i])===
0)run=true;if(run){data={action:"frm_strp_amount",form:JSON.stringify(jQuery(field).closest("form").serializeArray()),nonce:frm_stripe_vars.nonce};postAjax(data,function(){})}}function postAjax(data,success){var xmlHttp=new XMLHttpRequest,params=typeof data=="string"?data:Object.keys(data).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(data[k])}).join("&");xmlHttp.open("post",frm_stripe_vars.ajax,true);xmlHttp.onreadystatechange=function(){var response;if(xmlHttp.readyState>3&&
xmlHttp.status==200){response=xmlHttp.responseText;if(response!=="")response=JSON.parse(response);success(response)}};xmlHttp.setRequestHeader("X-Requested-With","XMLHttpRequest");xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");xmlHttp.send(params);return xmlHttp}function loadElements(){if(document.getElementsByClassName("frm-card-element").length)maybeLoadStripeLink()}function maybeLoadStripeLink(){var stripeLinkForm,formId,intentField;stripeLinkForm=document.querySelector("form.frm_stripe_link_form");
if(!stripeLinkForm)return false;formId=parseInt(stripeLinkForm.querySelector('input[name="form_id"]').value);intentField=stripeLinkForm.querySelector('input[name="frmintent'+formId+'[]"]');if(!intentField)return false;disableSubmit(stripeLinkForm);loadStripeLinkElements(intentField.value);return true}function disableSubmit(form){jQuery(form).find('input[type="submit"],input[type="button"],button[type="submit"]').not(".frm_prev_page").attr("disabled","disabled")}function loadStripeLinkElements(clientSecret){var cardElement,
appearance;cardElement=document.querySelector(".frm-card-element");if(!cardElement)return;appearance={theme:"stripe",variables:{fontSizeBase:frm_stripe_vars.style.base.fontSize,colorText:maybeAdjustColorForStripe(frm_stripe_vars.appearanceRules[".Input"].color),colorBackground:maybeAdjustColorForStripe(frm_stripe_vars.appearanceRules[".Input"].backgroundColor),fontSmooth:"auto"},rules:frm_stripe_vars.appearanceRules};elements=frmstripe.elements({clientSecret:clientSecret,appearance:appearance});isStripeLink=
true;insertAuthenticationElement(cardElement);insertPaymentElement(cardElement)}function maybeAdjustColorForStripe(color){var rgba,hex;if(0!==color.indexOf("rgba"))return color;rgba=color.replace(/^rgba?\(|\s+|\)$/g,"").split(",");hex="#"+((1<<24)+(parseInt(rgba[0],10)<<16)+(parseInt(rgba[1],10)<<8)+parseInt(rgba[2],10)).toString(16).slice(1);return hex}function insertAuthenticationElement(cardElement){var addAboveCardElement,emailField,authenticationMountTarget,emailInput,cardFieldContainer,defaultEmailValue,
authenticationElement;addAboveCardElement=true;emailField=checkForEmailField();authenticationMountTarget=createMountTarget("frm-link-authentication-element");if(false!==emailField)if("hidden"===emailField.getAttribute("type"))emailInput=emailField;else{addAboveCardElement=false;emailInput=emailField.querySelector("input");replaceEmailField(emailField,emailInput,authenticationMountTarget)}if(addAboveCardElement){cardFieldContainer=cardElement.closest(".frm_form_field");cardFieldContainer.parentNode.insertBefore(authenticationMountTarget,
cardFieldContainer)}defaultEmailValue=false!==emailField?getSettingFieldValue(emailField):"";authenticationElement=elements.create("linkAuthentication",{defaultValues:{email:defaultEmailValue}});authenticationElement.mount(".frm-link-authentication-element");authenticationElement.on("change",getAuthenticationChangeHandler(cardElement,emailInput))}function getAuthenticationChangeHandler(cardElement,emailInput){function syncEmailInput(emailValue){if("string"===typeof emailValue&&emailValue.length)emailInput.value=
emailValue}return function(event){var form;linkAuthenticationElementIsComplete=event.complete;if(linkAuthenticationElementIsComplete&&"undefined"!==typeof emailInput)syncEmailInput(event.value.email);form=cardElement.closest("form");if(readyToSubmitStripeLink(form)){thisForm=form;running=0;enableSubmit()}else disableSubmit(form)}}function replaceEmailField(emailField,emailInput,authenticationMountTarget){var emailLabel;emailField.insertBefore(authenticationMountTarget,emailInput);emailInput.type=
"hidden";emailLabel=emailField.querySelector(".frm_primary_label");if(emailLabel)emailLabel.style.display="none"}function insertPaymentElement(cardElement){var paymentElement;cardElement.parentNode.insertBefore(createMountTarget("frm-payment-element"),cardElement);paymentElement=elements.create("payment",{defaultValues:{billingDetails:{name:getFullNameValueDefault(),phone:""}}});paymentElement.mount(".frm-payment-element");paymentElement.on("change",handlePaymentElementChange);function handlePaymentElementChange(event){stripeLinkElementIsComplete=
event.complete;toggleButtonsOnPaymentElementChange(cardElement)}}function toggleButtonsOnPaymentElementChange(cardElement){var form=cardElement.closest(".frm-show-form");if(readyToSubmitStripeLink(form)){thisForm=form;running=0;enableSubmit()}else disableSubmit(form)}function readyToSubmitStripeLink(form){return linkAuthenticationElementIsComplete&&stripeLinkElementIsComplete}function getFullNameValueDefault(){var nameValues,firstNameField,lastNameField;nameValues=[];firstNameField=checkForStripeSettingField("first_name");
if(false!==firstNameField)nameValues.push(getSettingFieldValue(firstNameField));lastNameField=checkForStripeSettingField("last_name");if(false!==lastNameField)nameValues.push(getSettingFieldValue(lastNameField));return nameValues.join(" ")}function getSettingFieldValue(field){var value;if("hidden"===field.getAttribute("type"))value=field.value;else value=field.querySelector("input").value;return value}function checkForEmailField(){return checkForStripeSettingField("email")}function checkForStripeSettingField(settingKey){var settingField=
false;each(getStripeSettings(),checkStripeSettingForField);function checkStripeSettingForField(currentSetting){var currentSettingValue,settingIsWrappedAsShortcode,currentFieldId,fieldMatchByKey,fieldContainer,hiddenInput;if("string"!==typeof currentSetting[settingKey]||!currentSetting[settingKey].length)return;currentSettingValue=currentSetting[settingKey];settingIsWrappedAsShortcode="["===currentSettingValue[0]&&"]"===currentSettingValue[currentSettingValue.length-1];if(settingIsWrappedAsShortcode){currentFieldId=
currentSettingValue.substr(1,currentSettingValue.length-2);if(isNaN(currentFieldId))fieldMatchByKey=fieldContainer=document.getElementById("field_"+currentFieldId)}else currentFieldId=currentSettingValue;if(fieldMatchByKey)fieldContainer=fieldMatchByKey.closest(".frm_form_field");else fieldContainer=document.getElementById("frm_field_"+currentFieldId+"_container");if(!fieldContainer){hiddenInput=document.querySelector('input[name="item_meta['+currentFieldId+']"]');if(!hiddenInput)if("first_name"===
settingKey)hiddenInput=document.querySelector('input[name="item_meta['+currentFieldId+'][first]"]');else if("last_name"===settingKey)hiddenInput=document.querySelector('input[name="item_meta['+currentFieldId+'][last]"]');if(hiddenInput){settingField=hiddenInput;return false}return}settingField=fieldContainer;return false}return settingField}function createMountTarget(className){var newElement=document.createElement("div");newElement.className=className+" frm_form_field form-field";return newElement}
function each(items,callback){var index,length;length=items.length;for(index=0;index<length;index++)if(false===callback(items[index],index))break}jQuery(document).ready(function(){var stripeParams={locale:frm_stripe_vars.locale,stripeAccount:frm_stripe_vars.account_id};frmstripe=Stripe(frm_stripe_vars.publishable_key,stripeParams);loadElements();jQuery(document).on("frmPageChanged",loadElements);jQuery(document).off("submit.formidable",".frm-show-form");jQuery(document).on("submit.frmstrp",".frm-show-form",
validateForm);jQuery(document).on("frmFieldChanged",priceChanged)})})();
